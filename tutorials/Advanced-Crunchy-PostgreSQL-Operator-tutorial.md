---
title: Crunchy Data PostgreSQL Operator Tutorial
description: This tutorial explains how to use Crunchy PostgreSQL Operator (PGO)
---

### Introduction

The PostgreSQL Operator Client, aka pgo, is the most convenient way to interact with the PostgreSQL Operator. pgo provides many convenience methods for creating, managing, and deleting PostgreSQL clusters through a series of simple commands.

### Check the PostgreSQL DB Operator 

```execute
kubectl get pods -n pgo
```

You should see a pod starting with 'postgres-operator' with Ready value '4/4' and Status 'Running'.

### PGO Setup

For user to create PostgreSQL database Cluster using Crunchy PostgreSQL DB Operator

```execute
cd /home/student/projects/postgres-operator && export PGO_OPERATOR_NAMESPACE=pgo 
```

Install Client Credentials and Download the PGO Binary and Client Certificates:

```execute
PGO_CMD=kubectl ./deploy/install-bootstrap-creds.sh && PGO_CMD=kubectl ./installers/kubectl/client-setup.sh
```

Export PGO data that will be used for Cluster creation

```execute
export PATH=/home/student/.pgo/pgo:$PATH && export PGOUSER=/home/student/.pgo/pgo/pgouser && export PGO_CA_CERT=/home/student/.pgo/pgo/client.crt && export PGO_CLIENT_CERT=/home/student/.pgo/pgo/client.crt && export PGO_CLIENT_KEY=/home/student/.pgo/pgo/client.key && export PGO_APISERVER_URL=https://127.0.0.1:32443
```

Set the default namespace for PGO commands. If you skip this step you will need to add "-n pgo" to all the commands to specify the namespace

```execute
export PGO_NAMESPACE=pgo

### Create a database

Create a PostgreSQL DB Cluster (database) specifying a database user and password. This will create 'my-db' cluster (database) and the 'pguser' database user with 'password' password will be created for accessing the created cluster (database)

```execute
pgo create cluster my-db --username pguser --password password
```

To create a new PostgreSQL DB Cluster (database) and the 'pguser' database user with an autogenerated password
```execute
pgo create cluster my-db --username pguser
```

If you don't specify a database user then a default 'testuser' database user with an autogenerated password will be created
```execute
pgo create cluster my-db
```

### Test database availability

Test connectivity to the created cluster (database). Note the IP (including the port) of the primary service that can be used to connect to this cluster (database).
The cluster (database) will be available when both the status of the primary service and of the primary instance will be **UP** 
```execute
pgo test my-db
```

To see the availability of all the clusters (databases)
```execute
pgo test --all
```

### Get database info

To get info about the created cluster (database). The service field shows the IP that can be used to connect to this cluster (database).
```execute
pgo show cluster my-db
```

To get info about all the clusters (databases).
```execute
pgo show cluster --all
```

### How to use PostgreSQL client (psql) to connect and use the created cluster (database)

Connect to database using PostgreSQL client (psql). Replace the 'primary-service-IP' with the correct value from 
'pgo test' or 'pgo show cluster' commands (don't incluse the port number, for example :5432).
If needed replace the database (-d flag), user (-U flag) or password (PGPASSWORD).
```execute
PGPASSWORD=password psql -h <primary-service-IP> -U pguser -d my-db
```

To enter interactively the password use this command. If needed replace the database (-d flag) or user (-U flag).
```execute
psql -h <primary-service-IP> -U pguser -d my-db
```

Using the PostgreSQL client (psql) you can create tables, insert data into them and execute queries.

Create a table
```execute
CREATE TABLE COMPANY(
   ID INT PRIMARY KEY     NOT NULL,
   NAME           TEXT    NOT NULL,
   AGE            INT     NOT NULL,
   ADDRESS        CHAR(50),
   SALARY         REAL,
   JOIN_DATE	  DATE
);
```

Insert Values into created table

```execute
INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,SALARY,JOIN_DATE) VALUES (1, 'Paul', 32, 'California', 20000.00,'2001-07-13');
```
The following example is to insert a row; here salary column is omitted and therefore it will have the default value âˆ’
```execute
INSERT INTO COMPANY (ID,NAME,AGE,ADDRESS,JOIN_DATE) VALUES (2, 'Allen', 25, 'Texas', '2007-12-13');
```

Fetch the data from the table

```execute
SELECT * FROM company;
```

To Exit from PostgreSQL client (psql)

```execute
\q
```

### Working with database users

Create a database 'test' user with the specified password for my-db database

```execute
pgo create user --username=test --password=password my-db
```

Create a database 'test2' user with an autogenerated password for my-db database

```execute
pgo create user --username=test2 my-db
```

Show the list of users
```execute
pgo show user my-db
```

Delete 'test2' user
```execute
pgo delete user --username=test2 my-db
```

### Clone a database

Clone 'my-db' database into a new database called 'my-db-copy'. A default 'testuser' user will be created. Note the username and the password required to connect to the 'my-db-copy' database

```execute
pgo create cluster my-db-copy --restore-from=my-db 
```

You can specify a database user for the new database. This will clone 'my-db' cluster (database) into a new 'my-db-copy' cluster (database) and the 'pguser' database user with 'password' password will be created for accessing the created cluster (database).
```execute
pgo create cluster my-db-copy --restore-from=my-db --username pguser --password password
```

### Backup and restore a database

Backup 'my-db' database. By default the created backup is an incremental backup. A full backup is created when the database is created.
Note that the command will just start the backup process. It will take a while until the backup will complete and will appear in the list of backups.

```execute
pgo backup my-db
```

To show the backups of 'my-db' database.
```execute
pgo show backup my-db
```

You can restore a cluster (database). During the restore the cluster (database) will be down. To see when the cluster is available use 'pgo test' command.

Usually you will restore a database at a specific point in time. For example, to restore to November 02, 2019 at 8:00am.
```execute
pgo restore my-db --pitr-target="2020-11-02 08:00:00.000000+00" --backup-opts="--type=time"
```

Rarely you will want to execute a full restore. To execute a full restore of a database: 
```execute
pgo restore my-db
```

### Delete a database

This will delete 'my-db' cluster (database). This command will just start the process of deleting the cluster (database).
To see when the cluster (database) was deleted use 'pgo test --all' command.

```execute
pgo delete cluster my-db
```



